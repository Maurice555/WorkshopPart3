<html>
	<head>
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.0.min.js"></script>
	<title>Broodjes en Drankjes</title>
		<style type="text/css">
			html, body {
				padding: 0;
				margin: 0;
			}
			
			#aanbod {
				margin: 0;
				display: block;
				padding: 1em;
				background-color: #001a0d;
				box-shadow: 0px 2px 6px black inset;
			}
			.nav {
				background-color: #062d2d;
				border-top: 1px solid grey;
			}
			#voegartitoe {
				position: absolute;
				margin-left: 120px;
				background-image: url("images/arrow.png");
				background-size: 160px 240px;
				width: 160px;
				height: 240px;
			}
			
			table.showroom {
				width: 960px;
				background-color: #3b111f;
				padding: 3px;
				border: 1px solid grey;
				border-radius: 10px;
				table-layout: fixed;
			} table.showroom:hover {
				box-shadow: 0px 0px 8px #9cff33;
				border-color: #9cff33;
			} .showroom td {
				background-color: #593a78; /*#a7bebe #bff28c #9cff33*/
				padding: 0px 0px 4px 0px;
				border: 3px solid #3b111f;
				border-top-color: #9ce64c;
				overflow: hidden;
				-webkit-transition-duration: 0.7s;
				transition-duration: 0.7s;
			} .showroom td:hover {
				border-top-color: #9cff33;
				background-color: #78981b;
			} .showroom h5 {
				font-family: "Trebuchet MS", Helvetica, sans-serif;
				font-size: 20pt;
				font-style: italic oblique;
				color: lightgrey;
				background-color: #3b111f;
			} .showroom img {
				margin: auto;
				display: block;
				width:288px;
				height:220px;
			}
			#aanbod button {
				width: 128px;
				height: 32px;
				border: 1px solid black;
				border-top-color: white;
				border-left-color: lightgrey;
				color: lightgrey;
				font-size: 14pt;
				text-align: center;
				-webkit-transition-duration: 0.3s;
				transition-duration: 0.3s;
			} #aanbod button:hover {
				color: white;
				box-shadow: 1px 1px 5px 0px #3b111f;
			} #aanbod button:active {
				width: 120px;
				height: 30px;
				margin: 2px 4px 0px 4px;
				box-shadow: 0 0 0 0;
			} 
			.nav button {
				width: 120px;
				height: 28px;
				color: lightgrey;
				background-color: #1f473d;
				border: 2px solid #1f473d;
				border-top-color: darkgrey;
			} .nav button:hover {
				border-top-color: #51fbfb;
				color: white;
			}
		</style>
		<script type="text/javascript">

			var aanbod = [];
				
			function drawArtikelCell(artikel){
				var imgUrl = '<img src="images/aanbod'+ artikel.id +'.jpg">';
				var presentArtikel = "<h5>"+ artikel.naam +'</h5>'+ imgUrl +"</br>"+ artikel.omschrijving +
						"</br>&euro; "+ artikel.prijs.toFixed(2) +"</br>";
				var button = '<button onclick="addArtikel('+ artikel.id +')">ja lekker</button>';
				return '<td>'+ presentArtikel + button +"</td>";
			}
			function drawCurrentBestelling(bestelling){
				var bestellijst = getBestellijst(bestelling);
				var bestelTabel = "";
				var totaalPrijs = 0;
				for (var i = 0; i < bestellijst.length; i++){
				 	bestelTabel += '<tr>'+ drawCurrentArtikelAantal(bestellijst[i]) +'</tr>';
				 	totaalPrijs += bestellijst[i].aantalMaalPrijs();
				}
				return '<table align="center">'+ bestelTabel +'<tr><td colspan ="4" align="right" style="border-top:1px solid;">totaal: &euro; '+ totaalPrijs.toFixed(2) +'</td><td><button onclick="saveBestelling()">opslaan</button></td></tr></table>';
			}
			function drawCurrentArtikelAantal(artikelAantal){
				var newCell = '</td><td>';
				return '<td>'+ artikelAantal.id +'</td><td id="artikelnaam">'+ artikelAantal.naam + newCell + '&euro; '+artikelAantal.prijs.toFixed(2) + newCell + artikelAantal.aantal + newCell +'<button onclick="removeArtikel('+ artikelAantal.id +')">-</button></td>';
			}
			function ArtikelAantal(id, naam, omschrijving, prijs, aantal){
				this.id = id;
				this.naam = naam;
				this.omschrijving = omschrijving;
				this.prijs = prijs;
				this.aantal = aantal;
				this.aantalMaalPrijs = function(){ return this.prijs * this.aantal; }
			}			
			function getBestellijst(bestelling){
				var bestellijst = [];
				var entries = bestelling.artikelen.entry;
				for (var i = 0; i < entries.length; i++){
					var artikelAantal = new ArtikelAantal(
						entries[i]["key"]["id"], 
						entries[i]["key"]["naam"], 
						entries[i]["key"]["omschrijving"], 
						entries[i]["key"]["prijs"], 
						entries[i]["value"]
					);
					bestellijst.push(artikelAantal);	
				}
				return bestellijst;
			}
			
			function addArtikel(id){
				$("#voegartitoe").show(72);
				var div = document.getElementById("voegartitoe");
				var pos = 144;
				var interval = setInterval(frame, 3);
				function frame(){
					if (pos == 0){
						clearInterval(interval);
					} else {
						pos--;
						div.style.top = pos +"px";
					}
				}
				$.getJSON("WorkshopPart3/bestelling/add/artikelId="+ id, function(bestelling){
					$(".bestelling").html(drawCurrentBestelling(bestelling));
				});
				$("#voegartitoe").hide(400);
			}
			function removeArtikel(id){
				$.getJSON("WorkshopPart3/bestelling/remove/artikelId="+ id, function(bestelling){
					$(".bestelling").html(drawCurrentBestelling(bestelling));
				});
			}
			function printRows(index, artikel){
				$("table.showroom tr:last").append(drawArtikelCell(artikel));
				if ((index + 1) % 3 == 0) { $("table.showroom").append("<tr></tr>"); }
			}
			function printTable(num){
				document.getElementById("aanbod").innerHTML = '<table class="showroom" align="center"><tr></tr></table>';
				var i = (num - 1) * 12;
				var end = i + 12;
				for (i; i < end; i++) {
					printRows(i, aanbod[i]);
				}
			}
			
			$(document).ready(function(){
				var tableCount = 0;
				$.getJSON("WorkshopPart3/bestelling/get", function(bestelling){
					$(".bestelling").html(drawCurrentBestelling(bestelling));
				});
				$.getJSON("WorkshopPart3/service/bestelling/simple/fetch", function(result){
					$.each(result, function(index, artikel){
						aanbod.push(artikel);
						if (index == 0 || (index + 1) % 12 == 0) {
							tableCount++;
							$(".nav").append('<button onclick="printTable('+ tableCount +')">tabel'+ tableCount +
								'</button>');
						}
						if (index >= 144) { return false; } // break;
						if (index > 11) { return; } // equivalent to: continue;
						printRows(index, artikel);
					});
				});
			});

		</script>
	</head>
	<body>
		
		<div class="header">Vandaag vers in de Aanbieding</div>

		<div id="aanbod">
			<table class="showroom" align="center"><tr></tr></table>

		</div>
		
	</body>
</html>
